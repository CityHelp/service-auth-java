name: Deploy to Render

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: production

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Trigger Render deployment
        run: |
          echo "Notifying Render of new commit..."
          echo "Render automatically detects pushes to main branch"
          echo "Repository: ${{ github.repository }}"
          echo "Branch: ${{ github.ref }}"
          echo "Commit: ${{ github.sha }}"
          echo "Author: ${{ github.actor }}"
          echo ""
          echo "Render webhook will handle the deployment automatically"
          echo "Monitor progress at: https://dashboard.render.com/"

      - name: Deployment notification
        if: success()
        run: |
          echo "## Render Deployment Triggered" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âœ… Push to **main** branch detected" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ“ Commit: \`${{ github.sha }}\`" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ‘¤ Author: **${{ github.actor }}**" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸš€ **Render is now deploying your changes**" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ“Š Monitor the deployment:" >> $GITHUB_STEP_SUMMARY
          echo "- Dashboard: https://dashboard.render.com/" >> $GITHUB_STEP_SUMMARY
          echo "- Service: service-auth-java" >> $GITHUB_STEP_SUMMARY
          echo "- Health: https://service-auth-java.onrender.com/actuator/health" >> $GITHUB_STEP_SUMMARY
